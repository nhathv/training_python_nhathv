<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="Gadget x" />
    <Require feature="opensocial-0.9" />
	<Require feature="osapi" />
    <Content type="html" preferred_height="440"><![CDATA[
    <!DOCTYPE html>
<html>
<head>
    <title>Dojo guestbook</title>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/dojo/1.10.0/dijit/themes/claro/claro.css" />
    <link type="text/css" rel="stylesheet" href="{{ origin }}/static/js/guestbook/widget/css/GreetingWidget.css" />
    <base href="{{origin}}" target="_blank" />
    <script>
        function setCookie(domain, cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+d.toUTCString();
            document.cookie = cname + "=" + cvalue + "; " + expires
                                +";domain="+domain+";path=/gadget";
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for(var i=0; i<ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1);
                if (c.indexOf(name) != -1) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function checkCSRFTOKENCookie(domain, csrftoken) {
            var saved_csrftoken=getCookie("csrftoken");
            if (saved_csrftoken == "" && csrftoken != "" && csrftoken != null) {
                setCookie(domain, "csrftoken", csrftoken, 30);
            }
        }
    </script>
</head>
<body>
<h1>Guestbook</h1>
<div id="greetingContainer"></div>
<!-- Configure Dojo -->
<script>
    var dojoConfig = (function(){
        return {
            async: true,
            isDebug: true,
            parseOnLoad : true,
            packages: [{
                name: "myGuestbook",
                location: "{{ origin }}/static/js/guestbook"
            }],
{#            settings: {#}
{#		        csrfToken: 'dummy',#}
{#		        origin: '{{ origin|escapejs }}',#}
{#	}#}
        };
    })();
</script>
<div data-dojo-type="guestbook.GuestbookWidget"></div>
<script src="//ajax.googleapis.com/ajax/libs/dojo/1.10.0/dojo/dojo.js"></script>
<script type="text/javascript">
    require([
        "dojo/parser",
        "dojo/_base/config",
        "myGuestbook/widget/GuestbookWidget",
        "dojo/domReady!"
    ], function(parser, config){
        if (!config.parseOnLoad) {
            parser.parse();
        }
    });
</script>
<br>
==== CSRF ====
<input value="{{ csrf_token }}" id="tmp_csrf_token"/>
=== ORIGIN ===
<input value="{{ origin }}" id="tmp_origin"/>
<script>
    var tmp = document.getElementById("tmp_csrf_token");
    var tmp2 = document.getElementById("tmp_origin");
    checkCSRFTOKENCookie(tmp2.value, tmp.value);
</script>
<br>
<input id="is_user_admin" value="{{ is_user_admin }}" type="hidden"/>
<input id="user_login" value="{{ user_login }}" type="hidden"/>
<br>
<br>
<a href="{{ url }}">{{ url_linktext }}</a>
</body>
</html>
]]></Content>
</Module>